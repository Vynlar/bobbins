<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Bobbin'o'matic</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="/apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->
        <link rel="stylesheet" href="/main.css">
    </head>
    <body class="bg-blue-50 max-w-screen-md mx-auto pt-20">
        <!--[if lt IE 8]>
            <p class="browserupgrade">
            You are using an <strong>outdated</strong> browser. Please
            <a href="http://browsehappy.com/">upgrade your browser</a> to improve
            your experience.
            </p>
        <![endif]-->

        <section class="p-8 bg-white shadow rounded border border-blue-300 space-y-8 mx-4">
            <div>
                <h1 class="text-4xl font-bold text-center text-blue-900">Bobbin'o'matic</h1>
                <p class="text-center">
                    3D-printable thread bobbins with labels
                </p>
            </div>

            <div class="text-center my-8">Loading...</div>

        </section>
        <footer class="text-center mt-8">
            <span class="text-sm text-gray-600">Made by</span><br />
            <a href="https://adrianaleixandre.com" class="underline">Adrian Aleixandre</a>
            | <a href="https://twitter.com/_aaleixandre" class="underline">Twitter</a>
        </footer>

        <script type="text/javascript">
         function poll() {
             var search = window.location.search

             var url = '/build' + search
             fetch(url).then((response) => {
                 if(response.status === 202) {
                    setTimeout(poll, 5000)
                     return
                 } else {
                     response.blob().then(data => {
                         var a = document.createElement("a");
                         a.href = window.URL.createObjectURL(data);
                         a.download = "bobbins.zip";
                         a.click();
                         setTimeout(() => {
                             window.location = '/'
                         }, 1000)
                     })
                 }
             })
         }
         window.addEventListener('DOMContentLoaded', () => {
             poll()
         })
        </script>
    </body>
</html>
